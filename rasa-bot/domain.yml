version: "3.1"

intents:
  - greet
  - goodbye
  - affirm
  - deny
  - solicitar_manifiesto
  - informar_datos
  - consultar_pago
  - confirmar_pago
  - nlu_fallback

entities:
  - flete
  - descripcion
  - peso
  - fecha_cargue
  - fecha_descargue
  - tarjeta
  - licencia
  - origen
  - destino

slots:
  flete:
    type: text
    influence_conversation: false
    mappings:
    - type: from_entity
      entity: flete
    - type: from_text
      conditions:
      - active_loop: manifiesto_form
        requested_slot: flete

  descripcion:
    type: text
    influence_conversation: false
    mappings:
    - type: from_entity
      entity: descripcion
    - type: from_text
      conditions:
      - active_loop: manifiesto_form
        requested_slot: descripcion

  peso:
    type: text
    influence_conversation: false
    mappings:
    - type: from_entity
      entity: peso
    - type: from_text
      conditions:
      - active_loop: manifiesto_form
        requested_slot: peso

  fecha_cargue:
    type: text
    influence_conversation: false
    mappings:
    - type: from_entity
      entity: fecha_cargue
    - type: from_text
      conditions:
      - active_loop: manifiesto_form
        requested_slot: fecha_cargue

  fecha_descargue:
    type: text
    influence_conversation: false
    mappings:
    - type: from_entity
      entity: fecha_descargue
    - type: from_text
      conditions:
      - active_loop: manifiesto_form
        requested_slot: fecha_descargue

  tarjeta:
    type: text
    influence_conversation: false
    mappings:
    - type: from_entity
      entity: tarjeta
    - type: from_text
      conditions:
      - active_loop: manifiesto_form
        requested_slot: tarjeta

  licencia:
    type: text
    influence_conversation: false
    mappings:
    - type: from_entity
      entity: licencia
    - type: from_text
      conditions:
      - active_loop: manifiesto_form
        requested_slot: licencia

  origen:
    type: text
    influence_conversation: false
    mappings:
    - type: from_entity
      entity: origen
    - type: from_text
      conditions:
      - active_loop: manifiesto_form
        requested_slot: origen

  destino:
    type: text
    influence_conversation: false
    mappings:
    - type: from_entity
      entity: destino
    - type: from_text
      conditions:
      - active_loop: manifiesto_form
        requested_slot: destino

  # Nuevo slot para seguimiento de pago
  pago_pendiente:
    type: bool
    initial_value: false
    influence_conversation: true
    mappings:
    - type: custom

  monto_total:
    type: text
    influence_conversation: false
    mappings:
    - type: custom

responses:
  utter_greet:
    - text: "Buenos dÃ­as, gracias por comunicarte con Cootranscol Ltda. Â¿En quÃ© puedo ayudarte hoy? ðŸ˜Š"
    - text: "Buenas tardes, bienvenido a Cootranscol Ltda. Â¿CÃ³mo puedo asistirte? ðŸ˜Š"
    - text: "Â¡Hola! Un gusto saludarte. Soy tu asistente virtual de Cootranscol Ltda. Â¿En quÃ© te puedo colaborar? ðŸ˜Š"
  
  utter_goodbye:
    - text: "Que tengas un excelente dÃ­a. Estamos a tu disposiciÃ³n cuando lo necesites. Â¡Hasta pronto! ðŸ‘‹"
    - text: "Muchas gracias por contactarnos. Feliz dÃ­a y quedamos atentos a cualquier requerimiento. ðŸ‘‹"
    - text: "Con mucho gusto. Si necesitas algo mÃ¡s, no dudes en escribirnos. Â¡Que estÃ©s muy bien! ðŸ‘‹"

  utter_ask_flete:
    - text: "Por favor, indÃ­came el valor del flete para este transporte.\n\nPuedes escribirlo asÃ­: $150.000 o 150000"

  utter_ask_descripcion:
    - text: "Perfecto. Ahora necesito que me indiques la descripciÃ³n de la carga.\n\nÂ¿QuÃ© tipo de mercancÃ­a transportarÃ¡s?\nEjemplo: LÃ¡cteos, frijol y varios, electrodomÃ©sticos, etc."

  utter_ask_peso:
    - text: "Excelente. Â¿CuÃ¡l es el peso total de la carga?\n\nPuedes indicarlo en kilos o toneladas.\nEjemplo: 500 kg, 4.5 toneladas, 2000 kilos"

  utter_ask_fecha_cargue:
    - text: "Muy bien. Â¿CuÃ¡l es la fecha y hora de cargue?\n\nPuedes escribirlo asÃ­:\nâ€¢ Hoy a las 8:00 am\nâ€¢ 15 de octubre\nâ€¢ MaÃ±ana por la tarde"

  utter_ask_fecha_descargue:
    - text: "Entendido. Â¿CuÃ¡ndo se realizarÃ¡ el descargue?\n\nIndÃ­came la fecha y hora aproximada.\nEjemplo: 16 de octubre a las 5:00 pm"

  utter_ask_tarjeta:
    - text: "Necesito la informaciÃ³n de la tarjeta de propiedad del vehÃ­culo.\n\nPor favor, envÃ­ame:\nâ€¢ Foto de la tarjeta de propiedad, o\nâ€¢ NÃºmero de placa del vehÃ­culo"

  utter_ask_licencia:
    - text: "Casi terminamos. Por favor, envÃ­ame:\nâ€¢ Foto de la licencia de conducciÃ³n, o\nâ€¢ Nombre completo y cÃ©dula del conductor"

  utter_ask_origen:
    - text: "Â¿Desde dÃ³nde se realizarÃ¡ el cargue?\n\nIndÃ­came la ciudad o municipio de origen.\nEjemplo: BogotÃ¡, MedellÃ­n, Pasto, etc."

  utter_ask_destino:
    - text: "Â¿CuÃ¡l es el destino del transporte?\n\nIndÃ­came la ciudad o municipio de destino.\nEjemplo: Cali, Barranquilla, Bucaramanga, etc."

  utter_manifiesto_generado:
    - text: "Â¡Excelente! He generado exitosamente tu manifiesto de carga. ðŸ“‹âœ…\n\nEn un momento te enviarÃ© el documento completo."

  utter_solicitar_pago:
    - text: "Para finalizar, el valor del manifiesto es de $8.000 pesos.\n\nðŸ’³ Por favor realiza el pago a la siguiente cuenta Nequi:\nðŸ“± NÃºmero: 3106806180\nðŸ’° Valor: $8.000\n\nUna vez realices el pago, envÃ­ame el comprobante para procesar tu manifiesto. Â¡Gracias!"

  utter_confirmar_pago:
    - text: "Â¡Perfecto! He recibido tu comprobante de pago. âœ…\n\nYa puedo proceder con la generaciÃ³n de tu manifiesto.\nEn breve te enviarÃ© el documento completo. Â¡Muchas gracias por tu pago!"

  utter_fallback:
    - text: "Disculpa, no he comprendido bien tu mensaje. Â¿PodrÃ­as reformularlo?\n\nRecuerda que puedo ayudarte a:\nâ€¢ Generar manifiestos de carga\nâ€¢ Consultar informaciÃ³n de pago\nâ€¢ Resolver dudas sobre el servicio"
    - text: "PerdÃ³n, no entendÃ­ tu solicitud. Â¿PodrÃ­as explicarme de otra manera en quÃ© necesitas ayuda?\n\nEstoy aquÃ­ para asistirte con tus manifiestos de transporte. ðŸ˜Š"

  utter_agradecer:
    - text: "Â¡Con mucho gusto! Para eso estamos. ðŸ˜Š"
    - text: "Es un placer ayudarte. Â¡Estamos para servirte!"

actions:
  - action_default_fallback
  - action_submit_manifiesto
  - action_solicitar_pago
  - action_confirmar_pago
  - action_generar_manifiesto
  - validate_manifiesto_form

forms:
  manifiesto_form:
    required_slots:
      - flete
      - descripcion
      - peso
      - fecha_cargue
      - fecha_descargue
      - tarjeta
      - licencia
      - origen
      - destino

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true